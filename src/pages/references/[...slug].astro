---
import ArticleLayout from '../../layouts/ArticleLayout.astro';
import { getCollection } from 'astro:content';
import { sourceTypeConfig } from '../../data/taxonomy';

export async function getStaticPaths() {
  const entries = await getCollection('references');
  return entries.map((entry) => ({
    params: { slug: entry.id.replace(/\.md$/, '') },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const base = import.meta.env.BASE_URL;
const srcCfg = sourceTypeConfig[entry.data.sourceType as keyof typeof sourceTypeConfig];
---

<ArticleLayout
  title={entry.data.title}
  date={entry.data.date}
  tags={entry.data.tags}
  backHref={base}
  backLabel="Home"
>
  <div class="ref-meta-bar">
    {srcCfg && (
      <span class="ref-type" style={`color: ${srcCfg.color}`}>{srcCfg.icon} {srcCfg.label}</span>
    )}
    {entry.data.authors && <span class="ref-authors">{entry.data.authors}</span>}
    {entry.data.year && <span class="ref-year mono">({entry.data.year})</span>}
    <a href={entry.data.url} target="_blank" rel="noopener" class="ref-link">
      Open &nearr;
    </a>
  </div>

  <Content />
</ArticleLayout>

<style>
  .ref-meta-bar {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 12px;
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 16px;
    margin-bottom: 32px;
    font-size: 13px;
    color: var(--text-dim);
  }

  .ref-type {
    font-weight: 700;
    font-size: 12px;
  }

  .ref-authors { font-weight: 500; }
  .ref-year { color: var(--text-muted); }

  .ref-link {
    margin-left: auto;
    font-size: 12px;
    font-weight: 700;
    color: var(--cyan);
    padding: 4px 12px;
    border: 1px solid var(--border);
    border-radius: 6px;
    transition: all 0.15s;
  }

  .ref-link:hover {
    border-color: var(--cyan);
    background: rgba(34, 211, 238, 0.08);
  }
</style>
