---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const base = import.meta.env.BASE_URL;
const meetings = (await getCollection('meetings', ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
---

<BaseLayout title="è­°äº‹éŒ²ä¸€è¦§">
  <a href={base} class="back-link">&larr; ãƒ›ãƒ¼ãƒ </a>

  <header class="page-header">
    <div class="badge">MEETINGS</div>
    <h1>è­°äº‹éŒ²</h1>
    <p class="page-desc">
      äº‹æ¥­ä¼ç”»ãƒ»ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆé–‹ç™ºãƒ»å®šä¾‹ä¼šè­°ã®è¨˜éŒ²ã€‚
      {meetings.length > 0 ? `${meetings.length}ä»¶` : ''}
    </p>
  </header>

  {meetings.length > 0 ? (
    <div class="meeting-list">
      {meetings.map((m) => (
        <a href={`${base}/meetings/${m.id.replace(/\.md$/, '')}/`} class="meeting-row">
          <span class="meeting-date mono">{m.data.date.toISOString().slice(0, 10)}</span>
          <span class="meeting-title">{m.data.title}</span>
          <span class="meeting-meta">
            {m.data.participants.length > 0 && (
              <span class="participant-count">{m.data.participants.length}å</span>
            )}
            {m.data.nextActions && m.data.nextActions.length > 0 && (
              <span class="actions-badge">{m.data.nextActions.length} actions</span>
            )}
          </span>
        </a>
      ))}
    </div>
  ) : (
    <div class="empty-state">
      <div class="empty-icon">ğŸ“</div>
      <p>è­°äº‹éŒ²ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
      <p class="empty-hint">äº‹æ¥­ä¼ç”»ãƒ»ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆé–‹ç™ºãƒ»å®šä¾‹ä¼šè­°ã®è­°äº‹éŒ²ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
    </div>
  )}
</BaseLayout>

<style>
  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: var(--text-dim);
    padding: 8px 0;
    transition: color 0.15s;
  }
  .back-link:hover { color: var(--cyan); }

  .page-header {
    text-align: center;
    padding: 40px 0 32px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 40px;
  }
  .page-header h1 { margin: 12px 0 8px; }
  .page-desc { color: var(--text-muted); font-size: 14px; }

  .meeting-list {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .meeting-row {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 14px 16px;
    background: var(--bg-surface);
    border: 1px solid transparent;
    border-radius: 8px;
    color: var(--text);
    text-decoration: none;
    transition: all 0.15s;
  }
  .meeting-row:hover {
    border-color: var(--border-hover);
    background: var(--bg-raised);
  }

  .meeting-date {
    font-size: 12px;
    color: var(--text-muted);
    min-width: 90px;
  }
  .meeting-title {
    font-size: 14px;
    font-weight: 500;
    flex: 1;
  }
  .meeting-meta {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  .participant-count {
    font-size: 11px;
    color: var(--text-muted);
  }
  .actions-badge {
    font-size: 11px;
    font-weight: 600;
    color: var(--green);
    background: rgba(52, 211, 153, 0.1);
    padding: 2px 8px;
    border-radius: 8px;
  }

  .empty-state {
    text-align: center;
    padding: 80px 20px;
    color: var(--text-dim);
  }
  .empty-icon { font-size: 48px; margin-bottom: 16px; }
  .empty-state p { margin: 8px 0; }
  .empty-hint { font-size: 13px; color: var(--text-muted); }

  @media (max-width: 600px) {
    .meeting-row { flex-wrap: wrap; gap: 8px; }
    .meeting-date { min-width: auto; }
  }
</style>
